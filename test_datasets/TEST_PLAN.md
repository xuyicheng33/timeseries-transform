# 时序预测平台 - 完整测试方案

## 一、测试数据概览

### 1.1 数据集文件 (可直接上传)

| 文件名 | 行数 | 列数 | 用途 | 测试场景 |
|--------|------|------|------|----------|
| `weather_v2.csv` | 8760 | 5 | 天气数据（一年小时数据） | 基础功能、多模型对比 |
| `sensor_v2.csv` | 5000 | 7 | 工业传感器数据 | 多变量预测、异常检测 |
| `stock_v2.csv` | 500 | 8 | 股票价格数据 | 金融预测、小数据集 |
| `anomaly_v2.csv` | 3000 | 3 | 异常检测数据 | 异常检测评估 |
| `large_scale_v2.csv` | 50000 | 9 | 大规模数据 | 性能测试、降采样 |
| `missing_values_v2.csv` | 1000 | 7 | 缺失值数据 | 数据质量检测 |

### 1.2 预测结果文件 (prediction_results_v2/)

**格式要求：** 必须包含 `true_value` 和 `predicted_value` 两列

| 文件名模式 | 数量 | 说明 |
|------------|------|------|
| `result_weather_*.csv` | 10 | 天气温度预测结果 |
| `result_sensor_*.csv` | 10 | 传感器功率预测结果 |
| `result_stock_*.csv` | 10 | 股票价格预测结果 |
| `result_perfect_prediction.csv` | 1 | 完美预测 (R²=1.0) |
| `result_random_prediction.csv` | 1 | 随机预测 (R²≈0) |
| `result_large_scale.csv` | 1 | 大规模预测 (50000行) |

---

## 二、功能测试方案

### 2.1 用户认证模块测试

#### 测试用例 AUTH-001: 用户注册
| 项目 | 内容 |
|------|------|
| **前置条件** | 平台已启动，数据库已初始化 |
| **测试步骤** | 1. 访问注册页面<br>2. 输入用户名: `testuser1`<br>3. 输入邮箱: `test1@example.com`<br>4. 输入密码: `Test123456`<br>5. 点击注册 |
| **预期结果** | 注册成功，自动跳转到登录页 |
| **验证点** | 数据库中创建用户记录 |

#### 测试用例 AUTH-002: 用户登录
| 项目 | 内容 |
|------|------|
| **前置条件** | 用户已注册 |
| **测试步骤** | 1. 访问登录页面<br>2. 输入用户名/邮箱<br>3. 输入密码<br>4. 点击登录 |
| **预期结果** | 登录成功，跳转到数据中心页面 |
| **验证点** | localStorage 中存储 access_token 和 refresh_token |

#### 测试用例 AUTH-003: Token 自动刷新
| 项目 | 内容 |
|------|------|
| **前置条件** | 用户已登录，access_token 即将过期 |
| **测试步骤** | 1. 等待 access_token 过期（或手动修改）<br>2. 执行任意 API 请求 |
| **预期结果** | 自动使用 refresh_token 获取新 token，请求正常完成 |

#### 测试用例 AUTH-004: 登录失败
| 项目 | 内容 |
|------|------|
| **测试步骤** | 输入错误的用户名或密码 |
| **预期结果** | 显示错误提示"用户名或密码错误" |

---

### 2.2 数据集管理模块测试

#### 测试用例 DS-001: 上传数据集
| 项目 | 内容 |
|------|------|
| **测试数据** | `weather_v2.csv` |
| **测试步骤** | 1. 进入数据中心<br>2. 点击"上传数据集"<br>3. 选择文件<br>4. 输入名称: "天气数据测试"<br>5. 输入描述<br>6. 点击上传 |
| **预期结果** | 上传成功，列表显示新数据集 |
| **验证点** | - 行数: 8760<br>- 列数: 5<br>- 列名正确显示 |

#### 测试用例 DS-002: 上传大文件
| 项目 | 内容 |
|------|------|
| **测试数据** | `large_scale_v2.csv` (约 5MB) |
| **预期结果** | 上传成功，显示进度 |
| **验证点** | 50000 行数据正确解析 |

#### 测试用例 DS-003: 数据预览
| 项目 | 内容 |
|------|------|
| **前置条件** | 已上传 `weather_v2.csv` |
| **测试步骤** | 点击数据集的"预览"按钮 |
| **预期结果** | 显示前 100 行数据，表格可滚动 |
| **验证点** | - 列名正确<br>- 数据类型正确<br>- 无乱码 |

#### 测试用例 DS-004: 下载数据集
| 项目 | 内容 |
|------|------|
| **测试步骤** | 点击数据集的"下载"按钮 |
| **预期结果** | 浏览器下载 CSV 文件 |
| **验证点** | 下载文件与原文件内容一致 |

#### 测试用例 DS-005: 删除数据集
| 项目 | 内容 |
|------|------|
| **测试步骤** | 1. 点击"删除"按钮<br>2. 确认删除 |
| **预期结果** | 数据集从列表消失 |
| **验证点** | - 数据库记录删除<br>- 文件系统文件删除<br>- 关联的配置和结果级联删除 |

#### 测试用例 DS-006: 上传非 CSV 文件
| 项目 | 内容 |
|------|------|
| **测试数据** | 任意 .txt 或 .xlsx 文件 |
| **预期结果** | 显示错误提示"仅支持 CSV 文件" |

---

### 2.3 预测结果管理模块测试

#### 测试用例 RS-001: 上传预测结果
| 项目 | 内容 |
|------|------|
| **前置条件** | 已上传 `weather_v2.csv` 数据集 |
| **测试数据** | `prediction_results_v2/result_weather_LSTM_v1.0_high.csv` |
| **测试步骤** | 1. 进入结果仓库<br>2. 点击"上传结果"<br>3. 选择关联数据集<br>4. 输入结果名称: "LSTM高精度预测"<br>5. 输入模型名称: "LSTM"<br>6. 输入版本: "1.0"<br>7. 上传文件 |
| **预期结果** | 上传成功，自动计算指标 |
| **验证点** | - MSE, RMSE, MAE, R², MAPE 正确计算<br>- R² 应接近 0.99（高质量预测） |

#### 测试用例 RS-002: 上传缺少必需列的文件
| 项目 | 内容 |
|------|------|
| **测试数据** | 旧格式文件 `prediction_results/result_LSTM_v1.0_high.csv`（列名为 true, pred） |
| **预期结果** | 显示错误"缺少必需列: {'true_value', 'predicted_value'}" |

#### 测试用例 RS-003: 验证完美预测指标
| 项目 | 内容 |
|------|------|
| **测试数据** | `result_perfect_prediction.csv` |
| **预期结果** | - MSE = 0<br>- RMSE = 0<br>- MAE = 0<br>- R² = 1.0<br>- MAPE = 0% |

#### 测试用例 RS-004: 验证随机预测指标
| 项目 | 内容 |
|------|------|
| **测试数据** | `result_random_prediction.csv` |
| **预期结果** | R² 接近 0 或为负值 |

---

### 2.4 可视化对比模块测试

#### 测试用例 VIS-001: 单结果可视化
| 项目 | 内容 |
|------|------|
| **前置条件** | 已上传至少 1 个预测结果 |
| **测试步骤** | 1. 进入可视化对比页面<br>2. 选择 1 个结果<br>3. 点击"开始对比" |
| **预期结果** | 显示 True 曲线和预测曲线 |

#### 测试用例 VIS-002: 多模型对比
| 项目 | 内容 |
|------|------|
| **前置条件** | 已上传同一数据集的多个预测结果 |
| **测试数据** | 上传以下文件（关联同一数据集）：<br>- `result_weather_LSTM_v1.0_high.csv`<br>- `result_weather_Transformer_v1.0_high.csv`<br>- `result_weather_TCN_v1.0_high.csv` |
| **测试步骤** | 1. 选择 3 个结果<br>2. 点击"开始对比" |
| **预期结果** | - 显示 1 条 True 曲线 + 3 条预测曲线<br>- 指标表格显示 3 行数据<br>- 最优指标高亮显示 |

#### 测试用例 VIS-003: 降采样测试
| 项目 | 内容 |
|------|------|
| **测试数据** | `result_large_scale.csv` (50000 行) |
| **测试步骤** | 1. 上传大规模预测结果<br>2. 设置最大点数为 2000<br>3. 选择 LTTB 算法<br>4. 开始对比 |
| **预期结果** | - 图表显示约 2000 个点<br>- 提示"数据已降采样"<br>- 曲线形状保持原有特征 |

#### 测试用例 VIS-004: 误差分析
| 项目 | 内容 |
|------|------|
| **测试步骤** | 1. 完成多模型对比<br>2. 切换到"误差分析" Tab |
| **预期结果** | - 显示残差时序图<br>- 显示误差分布直方图<br>- 显示误差统计卡片（均值、标准差等） |

#### 测试用例 VIS-005: 雷达图
| 项目 | 内容 |
|------|------|
| **测试步骤** | 切换到"雷达图" Tab |
| **预期结果** | - 显示 5 维雷达图（MSE, RMSE, MAE, R², MAPE）<br>- 显示综合排名<br>- 显示原始指标值表格 |

#### 测试用例 VIS-006: 区间分析
| 项目 | 内容 |
|------|------|
| **测试步骤** | 1. 切换到"区间分析" Tab<br>2. 输入起始索引: 100<br>3. 输入结束索引: 500<br>4. 点击"计算区间指标" |
| **预期结果** | 显示指定区间内的指标值 |

#### 测试用例 VIS-007: 导出功能
| 项目 | 内容 |
|------|------|
| **测试步骤** | 1. 点击"导出 PNG"<br>2. 点击"导出 CSV" |
| **预期结果** | - 下载图表图片<br>- 下载包含所有结果数据的 CSV 文件 |

---

### 2.5 数据质量检测模块测试

#### 测试用例 QA-001: 缺失值检测
| 项目 | 内容 |
|------|------|
| **测试数据** | `missing_values_v2.csv` |
| **测试步骤** | 1. 上传数据集<br>2. 点击"数据质量检测" |
| **预期结果** | - 检测到各列的缺失率<br>- col_5pct: ~5% 缺失<br>- col_30pct: ~30% 缺失<br>- col_complete: 0% 缺失 |

#### 测试用例 QA-002: 异常值检测
| 项目 | 内容 |
|------|------|
| **测试数据** | `sensor_v2.csv`（vibration 列有异常值） |
| **预期结果** | 检测到 vibration 列存在异常值 |

#### 测试用例 QA-003: 质量评分
| 项目 | 内容 |
|------|------|
| **测试数据** | `weather_v2.csv`（高质量数据） |
| **预期结果** | 质量评分 > 90 分 |

---

### 2.6 配置向导模块测试

#### 测试用例 CFG-001: 创建配置
| 项目 | 内容 |
|------|------|
| **前置条件** | 已上传 `weather_v2.csv` |
| **测试步骤** | 1. 进入配置向导<br>2. 选择数据集<br>3. 选择通道: temperature, humidity<br>4. 选择归一化: MinMax<br>5. 设置窗口大小: 100<br>6. 设置步长: 10<br>7. 完成配置 |
| **预期结果** | - 配置创建成功<br>- 自动生成标准文件名 |

---

### 2.7 实验组管理模块测试

#### 测试用例 EXP-001: 创建实验组
| 项目 | 内容 |
|------|------|
| **测试步骤** | 1. 进入实验管理<br>2. 点击"新建实验"<br>3. 输入名称: "温度预测对比实验"<br>4. 添加多个预测结果 |
| **预期结果** | 实验组创建成功，显示关联的结果列表 |

#### 测试用例 EXP-002: 实验组内对比
| 项目 | 内容 |
|------|------|
| **测试步骤** | 在实验组详情页点击"对比分析" |
| **预期结果** | 跳转到可视化页面，自动选中实验组内的所有结果 |

---

### 2.8 性能测试

#### 测试用例 PERF-001: 大文件上传性能
| 项目 | 内容 |
|------|------|
| **测试数据** | `large_scale_v2.csv` (50000 行, ~5MB) |
| **预期结果** | 上传时间 < 30 秒 |

#### 测试用例 PERF-002: 大数据可视化性能
| 项目 | 内容 |
|------|------|
| **测试数据** | `result_large_scale.csv` |
| **预期结果** | - 降采样后渲染时间 < 3 秒<br>- 图表交互流畅 |

#### 测试用例 PERF-003: 多结果对比性能
| 项目 | 内容 |
|------|------|
| **测试步骤** | 同时对比 10 个预测结果 |
| **预期结果** | 加载时间 < 5 秒 |

---

## 三、测试执行清单

### 3.1 冒烟测试（快速验证）

```
□ AUTH-001: 用户注册
□ AUTH-002: 用户登录
□ DS-001: 上传数据集 (weather_v2.csv)
□ RS-001: 上传预测结果 (result_weather_LSTM_v1.0_high.csv)
□ VIS-001: 单结果可视化
□ VIS-002: 多模型对比
```

### 3.2 完整功能测试

```
认证模块:
□ AUTH-001 ~ AUTH-004

数据集模块:
□ DS-001 ~ DS-006

结果模块:
□ RS-001 ~ RS-004

可视化模块:
□ VIS-001 ~ VIS-007

数据质量模块:
□ QA-001 ~ QA-003

配置模块:
□ CFG-001

实验组模块:
□ EXP-001 ~ EXP-002

性能测试:
□ PERF-001 ~ PERF-003
```

---

## 四、测试数据使用指南

### 4.1 快速开始

```bash
# 1. 启动平台
cd timeseries-platform
start-all.bat

# 2. 访问平台
# 前端: http://localhost:5173
# API 文档: http://localhost:8000/api/docs

# 3. 注册账号并登录

# 4. 上传测试数据
# - 数据集: test_datasets/weather_v2.csv
# - 预测结果: test_datasets/prediction_results_v2/result_weather_*.csv
```

### 4.2 测试数据对应关系

| 数据集 | 对应预测结果 | 模型数量 |
|--------|--------------|----------|
| weather_v2.csv | result_weather_*.csv | 10 |
| sensor_v2.csv | result_sensor_*.csv | 10 |
| stock_v2.csv | result_stock_*.csv | 10 |
| large_scale_v2.csv | result_large_scale.csv | 1 |

### 4.3 预测质量说明

| 质量级别 | 噪声水平 | 预期 R² | 文件后缀 |
|----------|----------|---------|----------|
| high | ~2% | > 0.95 | `_high.csv` |
| medium | ~8% | 0.7~0.9 | `_medium.csv` |
| low | ~20% | 0.3~0.6 | `_low.csv` |

---

## 五、已知问题和注意事项

### 5.1 旧版测试数据不兼容

**问题：** `prediction_results/` 目录下的旧文件使用 `true` 和 `pred` 列名，无法上传。

**解决：** 使用 `prediction_results_v2/` 目录下的新文件，列名为 `true_value` 和 `predicted_value`。

### 5.2 数据集与结果的关联

**注意：** 上传预测结果时，必须选择正确的关联数据集。不同数据集的预测结果不应混合对比。

### 5.3 大文件测试

**建议：** 测试大文件（50000行）时，确保浏览器有足够内存，建议使用 Chrome 最新版本。

---

## 六、自动化测试脚本

### 6.1 API 测试脚本位置

```
backend/tests/
├── conftest.py          # 测试配置
├── test_auth.py         # 认证测试
├── test_datasets.py     # 数据集测试
└── test_results.py      # 结果测试
```

### 6.2 运行测试

```bash
cd backend
# 激活虚拟环境
venv\Scripts\activate

# 运行所有测试
pytest

# 运行特定测试
pytest tests/test_auth.py -v

# 生成覆盖率报告
pytest --cov=app --cov-report=html
```

---

**文档版本：** v1.0  
**更新日期：** 2026-01-11  
**作者：** AI Assistant

